# 0x0 前言
### CVE-2018-7600 Description  
Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1 allows remote attackers to execute arbitrary code because of an issue affecting multiple subsystems with default or common module configurations.

### Drupal
Drupal is a free and open-source web content management framework written in PHP and distributed under the GNU General Public License.

* ()內為測試時使用之環境
* <>為可變動或需視使用環境變動的欄位
* `斜體字`為指令


# 0x1 前置需求
* 虛擬機軟體 (VMware Workstation 15.5.7)
* 攻擊機 (Kali Linux 2020.4)
* 受攻擊機 (Ubuntu 20.04)


# 0x2 受攻擊機環境建置(失敗！！)
### 安裝Drupal 8.5相依的PHP 7.2
1. `sudo apt install php7.2 libapache2-mod-php7.2 php7.2-common php7.2-mbstring php7.2-gd php7.2-intl php7.2-curl php7.2-xml php7.2-mysql php7.2-pgsql php7.2-bcmath`

### 安裝MySQL 5.7與建立Database
> 實測安裝MySQL  8.0會在安裝Drupal時會發生 SQLSTATE[42000]: Syntax error or access violation: 1231 Variable 'sql_mode' can't be set to the value of 'NO_AUTO_CREATE_USER'. 的問題，至於其他版本沒有測試過
2. 參照 https://computingforgeeks.com/how-to-install-mysql-on-ubuntu-focal/ ，於Ubuntu 20.04安裝MySQL 5.7 (需注意Step 3安裝MySQL時的小版本5.7.XX可能會與文中不一樣，要記得改)

3. `sudo mysql -u root -p`，執行mysql

4. `CREATE DATABASE drupal CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;`，新增database **drupal**

5. `CREATE USER 'vulner'@'localhost' IDENTIFIED BY 'vul.,';`，建立使用者帳密 **vulner/vul.,** (密碼要加兩個符號才能符合密碼規定)

6. `GRANT ALL PRIVILEGES ON drupal.* TO 'vulner'@'localhost';`，賦予**使用者vulner**存取**database drupal**下所有table的權限

7. `FLUSH PRIVILEGES;`，寫入權限設定

8. `exit`，離開mysql console

### 安裝Drupal 8.5.0
9. 至 https://www.drupal.org/project/drupal/releases/8.5.0 下載Drupal 8.5.0並解壓縮至/var/www/html/

10. `cd /var/www/html`，切換至web家目錄

11. `sudo chown -R www-data:www-data ./*`，更改目錄下所有檔案的擁有者

12. 開啟瀏覽器，於網址列輸入`127.0.0.1`，出現以下安裝畫面，一路Continue  
![](image/2.12_install.PNG)

13. 直到出現Requirements檢查的頁面，按最下方的**continue anyway**以略過URL clean的設定  
![](image/2.13_skip.PNG)  
![](image/2.13_skip2.PNG)

14. 輸入Databse資訊  
![](image/2.14_database.PNG)

15. 網站訊息隨意輸入  
![](image/2.15_site_info.PNG)

16. 安裝完成，**但不知為何只能訪問首頁**，目前卡在這，簡單說就是一些子資料夾如/user並沒有被產生出來  
![](image/2.16_homepage.PNG)

    > 按右上角My account

![](image/2.16_user.PNG)

上網查到[這篇](https://www.drupal.org/forum/support/post-installation/2014-01-10/page-not-found-on-every-page-except-home-page)是因為Drupal放置於/var/www/html/下的子目錄才發生這個問題，但我不是放在子目錄  
這於[這篇](https://www.drupal.org/forum/support/post-installation/2020-07-25/the-requested-url-was-not-found-on-this-server)提到的.htaccess也沒有說要如何修改，而且以上作法似乎不會生出.htaccess，但是架在子目錄似乎就會生出來，但一樣無法訪問其他頁面  
而[這篇](https://askubuntu.com/questions/1128852/the-requested-url-drupal-admin-reports-was-not-found-on-this-server)的做法也沒有用

# 0x3 攻擊機環境建置
### Sub title 1
1. `Step 1`


### Exploit
2. `Step 2`
![](image/123123)


# 0x4 Snort/Suricata Rule
1. rule 1


# 0x5 Reference
* Reference 1


